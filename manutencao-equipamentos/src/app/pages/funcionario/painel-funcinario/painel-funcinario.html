<app-nav></app-nav>

<div class="container m-top">
    <div class="row justify-content-center painel-funcionario">

        <div class="col-3">
            <painel-acoes-funcionario />
        </div>

        <div class="col-8">
            <panel>
                <h3 class="text-center">Chamados</h3>

                <div class="filtros-chamados gap">

                    <div class="filtro-box">
                        <span>Status</span>
                        <select class="form-select form-select-sm" (change)="onStatusChange($event)">
                            <option value="">Todos</option>
                            <option value="ABERTA">Aberta</option>
                            <option value="APROVADA">Aprovada</option>
                            <option value="EM_ANDAMENTO">Em andamento</option>
                            <option value="REDIRECIONADA">Redirecionada</option>
                            <option value="PAGA">Paga</option>
                            <option value="FINALIZADA">Finalizada</option>
                        </select>
                    </div>

                    <div class="filtro-box" *ngIf="filtroSelecionado === 'PERIODO'">
                        <span>De</span>
                        <input type="date" class="form-control form-control-sm" (change)="onDataChange()"
                            [(ngModel)]="dataInicio">
                    </div>

                    <div class="filtro-box" *ngIf="filtroSelecionado === 'PERIODO'">
                        <span>Até</span>
                        <input type="date" class="form-control form-control-sm" (change)="onDataChange()"
                            [(ngModel)]="dataFim">
                    </div>
                </div>

                <ng-template #templateEditar let-row>
                    <div class="template-center">
                        @switch(row.estado) {
                        @case ('ABERTA') {
                        <button class="btn btn-cinza" (click)="openOrcamentoModal(row)">Orçar</button>
                        }
                        @case ('APROVADA') {
                        <button class="btn btn-amarelo" [routerLink]="['/func/manutencao', row.id]">Manutenção</button>
                        }
                        @case ('EM_ANDAMENTO') {
                        <button class="btn btn-marrom" [routerLink]="['/func/manutencao', row.id]">Manutenção</button>
                        }
                        @case ('REDIRECIONADA') {
                        <button class="btn btn-roxo" [routerLink]="['/func/manutencao', row.id]">Manutenção</button>
                        }
                        @case ('PAGA') {
                        <button class="btn btn-alaranjado" (click)="openFinalizarModal(row)">Finalizar</button>
                        }
                        }
                    </div>
                </ng-template>

                <!-- Template código -->
                <ng-template #templateCodigo let-row>
                    <div class="template-center">{{ row.codigo }}</div>
                </ng-template>

                <app-table-chamado [colunas]="[
                    { id: 'cliente', header: 'CLIENTE' },
                    { id: 'estado', header: 'ESTADO', headerStyle: 'col-2' },
                    { id: 'descricao', header: 'DESCRIÇÃO' },
                    { id: 'data_chamado', header: 'DATA', headerStyle: 'col-2' },
                    { id: 'acao', header: 'AÇÃO', render: templateEditar, headerStyle: 'col-2 text-center' }
                ]" [data]="chamadosFiltrados" />
            </panel>
        </div>
    </div>
</div>

<!-- MODAL ORÇAR -->
@if (orcamentoModalVisible) {
<app-efetuar-orcamento [id]="selectedChamado!" (close)="closeOrcamentoModal()">
</app-efetuar-orcamento>
}

<!-- MODAL FINALIZAR -->
@if (finalizarModalVisible) {
<app-modal (closeModalEvent)="closeFinalizarModal()">
    <h4>Finalizar Manutenção</h4>

    <form [formGroup]="finalizarForm" (ngSubmit)="confirmarFinalizarManutencao()">
        <div class="fundo-modal gap">
            <div class="input-div">
                <span>Descrição da Manutenção</span>
                <textarea class="base-input" rows="3" formControlName="descricaoManutencao"></textarea>
            </div>

            <div class="input-div">
                <span>Orientação ao Cliente</span>
                <textarea class="base-input" rows="3" formControlName="orientacao"></textarea>
            </div>
        </div>

        <div class="btn-div p-top">
            <button type="button" class="btn btn-vermelho" (click)="closeFinalizarModal()">Cancelar</button>
            <button type="submit" class="btn btn-verde" [disabled]="finalizarForm.invalid">Concluir</button>
        </div>
    </form>
</app-modal>
}